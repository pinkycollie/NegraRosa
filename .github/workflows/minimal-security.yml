# .github/workflows/minimal-security.yml
name: Minimal Security Checks

on: [pull_request, push]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run npm audit (fail on critical)
        run: npm audit --audit-level=critical
        
      - name: Check for banned imports
        run: |
          if grep -r "import.*drizzle" ./api/ || grep -r "import.*pg" ./api/; then
            echo "❌ Direct DB imports in /api not allowed"
            exit 1
          fi
          echo "✅ No banned imports found"
          
      - name: Check for .env files
        run: |
          if find . -name ".env" -not -path "./.env.example" | grep .; then
            echo "❌ .env files committed"
            exit 1
          fi
          echo "✅ No .env files found"